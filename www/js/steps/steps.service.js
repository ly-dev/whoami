'use strict';

angular.module('whoamiApp')

.factory('MyDiagnose', ['$q', '$log', 'MY_PARAMS',
    function ($q, $log, MY_PARAMS) {
        var heightTabls = {},
            zscoreTabls = {},
            conclusions = [],
            initialized = false,
            service = {},
            determineTable = function (gender, age) {
                var result;
                var tables = zscoreTabls[gender];

                if (tables) {
                    result = tables[(age > 24 ? 1 : 0)];
                    if (result) {
                        return result;
                    }
                }

                //should not be here
                throw 'Unable to determine zscore table (gender:' + gender + ', age:' + age + ').';
            },

            determineWeights = function (gender, age, height) {
                var result;
                var table = determineTable(gender, age);

                if (table) {
                    if (height < 45) {
                        height = 45;
                    }

                    if (height > 120) {
                        height = 120
                    }

                    result = table[height];
                    if (result) {
                        return result;
                    }
                }

                //should not be here
                throw 'Unable to determine weight range (gender:' + gender + ', age:' + age + ', height:' + height + ').';
            },
            determineZScore = function (gender, age, height, weight) {
                var result;
                var weights = determineWeights(gender, age, height);

                if (weights) {
                    for (var i = weights.length - 1; i >= 0; i--) {
                        if (weight >= weights[i]) {
                            break;
                        }
                    }

                    // convert from index to zscore
                    result = i - 3;
                    return result;
                }

                //should not be here
                throw 'Unable to determine zscore (gender:' + gender + ', age:' + age + ', height:' + height + ', weight:' + weight + ').';
            },

            init = function () {
                // avoid double initialize
                if (initialized) {
                    return;
                }

                initialized = true;
                // WHO height-to-age tables, source: http://www.who.int/childgrowth/standards
                heightTabls = {
                    'boy': {
                        '0': [44, 45.5, 46.3, 46.8, 47.5, 47.9, 48.6, 49.9, 51.2, 51.8, 52.3, 53, 53.4, 54.3, 55.7],
                        '1': [48.7, 50.2, 51.1, 51.5, 52.2, 52.7, 53.4, 54.7, 56, 56.7, 57.2, 57.9, 58.4, 59.3, 60.7],
                        '2': [52.2, 53.8, 54.7, 55.1, 55.9, 56.4, 57.1, 58.4, 59.8, 60.5, 61, 61.7, 62.2, 63.1, 64.6],
                        '3': [55.1, 56.7, 57.6, 58.1, 58.8, 59.3, 60.1, 61.4, 62.8, 63.5, 64, 64.8, 65.3, 66.2, 67.7],
                        '4': [57.5, 59, 60, 60.5, 61.2, 61.7, 62.5, 63.9, 65.3, 66, 66.6, 67.3, 67.8, 68.7, 70.3],
                        '5': [59.4, 61, 61.9, 62.4, 63.2, 63.7, 64.5, 65.9, 67.3, 68.1, 68.6, 69.4, 69.9, 70.8, 72.4],
                        '6': [61, 62.6, 63.6, 64.1, 64.9, 65.4, 66.2, 67.6, 69.1, 69.8, 70.4, 71.1, 71.6, 72.6, 74.2],
                        '7': [62.5, 64.1, 65.1, 65.6, 66.4, 66.9, 67.7, 69.2, 70.6, 71.4, 71.9, 72.7, 73.2, 74.2, 75.9],
                        '8': [63.8, 65.5, 66.5, 67, 67.8, 68.3, 69.1, 70.6, 72.1, 72.9, 73.4, 74.2, 74.7, 75.7, 77.4],
                        '9': [65, 66.8, 67.7, 68.3, 69.1, 69.6, 70.5, 72, 73.5, 74.3, 74.8, 75.7, 76.2, 77.2, 78.9],
                        '10': [66.2, 68, 69, 69.5, 70.4, 70.9, 71.7, 73.3, 74.8, 75.6, 76.2, 77, 77.6, 78.6, 80.3],
                        '11': [67.3, 69.1, 70.2, 70.7, 71.6, 72.1, 73, 74.5, 76.1, 77, 77.5, 78.4, 78.9, 80, 81.7],
                        '12': [68.4, 70.2, 71.3, 71.8, 72.7, 73.3, 74.1, 75.7, 77.4, 78.2, 78.8, 79.7, 80.2, 81.3, 83.1],
                        '13': [69.4, 71.3, 72.4, 72.9, 73.8, 74.4, 75.3, 76.9, 78.6, 79.4, 80, 80.9, 81.5, 82.6, 84.4],
                        '14': [70.4, 72.3, 73.4, 74, 74.9, 75.5, 76.4, 78, 79.7, 80.6, 81.2, 82.1, 82.7, 83.8, 85.7],
                        '15': [71.3, 73.3, 74.4, 75, 75.9, 76.5, 77.4, 79.1, 80.9, 81.8, 82.4, 83.3, 83.9, 85, 87],
                        '16': [72.2, 74.2, 75.4, 76, 76.9, 77.5, 78.5, 80.2, 82, 82.9, 83.5, 84.5, 85.1, 86.2, 88.2],
                        '17': [73.1, 75.1, 76.3, 76.9, 77.9, 78.5, 79.5, 81.2, 83, 84, 84.6, 85.6, 86.2, 87.4, 89.4],
                        '18': [73.9, 76, 77.2, 77.8, 78.8, 79.5, 80.4, 82.3, 84.1, 85.1, 85.7, 86.7, 87.3, 88.5, 90.6],
                        '19': [74.7, 76.8, 78.1, 78.7, 79.7, 80.4, 81.4, 83.2, 85.1, 86.1, 86.8, 87.8, 88.4, 89.7, 91.8],
                        '20': [75.5, 77.7, 78.9, 79.6, 80.6, 81.3, 82.3, 84.2, 86.1, 87.1, 87.8, 88.8, 89.5, 90.7, 92.9],
                        '21': [76.3, 78.4, 79.7, 80.4, 81.5, 82.2, 83.2, 85.1, 87.1, 88.1, 88.8, 89.9, 90.5, 91.8, 94],
                        '22': [77, 79.2, 80.5, 81.2, 82.3, 83, 84.1, 86, 88, 89.1, 89.8, 90.9, 91.6, 92.9, 95.1],
                        '23': [77.7, 80, 81.3, 82, 83.1, 83.8, 84.9, 86.9, 89, 90, 90.8, 91.9, 92.6, 93.9, 96.2],
                        '24': [77.7, 80, 81.4, 82.1, 83.2, 83.9, 85.1, 87.1, 89.2, 90.3, 91, 92.1, 92.9, 94.2, 96.6],
                        '25': [78.3, 80.7, 82.1, 82.8, 84, 84.7, 85.9, 88, 90.1, 91.2, 92, 93.1, 93.8, 95.2, 97.6],
                        '26': [79, 81.4, 82.8, 83.6, 84.7, 85.5, 86.7, 88.8, 90.9, 92.1, 92.9, 94, 94.8, 96.2, 98.6],
                        '27': [79.6, 82.1, 83.5, 84.3, 85.5, 86.3, 87.4, 89.6, 91.8, 93, 93.8, 94.9, 95.7, 97.1, 99.6],
                        '28': [80.2, 82.8, 84.2, 85, 86.2, 87, 88.2, 90.4, 92.6, 93.8, 94.6, 95.8, 96.6, 98.1, 100.6],
                        '29': [80.8, 83.4, 84.9, 85.7, 86.9, 87.7, 88.9, 91.2, 93.4, 94.7, 95.5, 96.7, 97.5, 99, 101.5],
                        '30': [81.4, 84, 85.5, 86.3, 87.6, 88.4, 89.6, 91.9, 94.2, 95.5, 96.3, 97.5, 98.3, 99.9, 102.5],
                        '31': [82, 84.6, 86.2, 87, 88.2, 89.1, 90.3, 92.7, 95, 96.2, 97.1, 98.4, 99.2, 100.7, 103.4],
                        '32': [82.5, 85.2, 86.8, 87.6, 88.9, 89.7, 91, 93.4, 95.7, 97, 97.9, 99.2, 100, 101.5, 104.2],
                        '33': [83.1, 85.8, 87.4, 88.2, 89.5, 90.4, 91.7, 94.1, 96.5, 97.8, 98.6, 99.9, 100.8, 102.4, 105.1],
                        '34': [83.6, 86.4, 88, 88.8, 90.1, 91, 92.3, 94.8, 97.2, 98.5, 99.4, 100.7, 101.5, 103.2, 105.9],
                        '35': [84.1, 86.9, 88.5, 89.4, 90.7, 91.6, 93, 95.4, 97.9, 99.2, 100.1, 101.4, 102.3, 103.9, 106.7],
                        '36': [84.6, 87.5, 89.1, 90, 91.3, 92.2, 93.6, 96.1, 98.6, 99.9, 100.8, 102.2, 103.1, 104.7, 107.5],
                        '37': [85.1, 88, 89.7, 90.6, 91.9, 92.8, 94.2, 96.7, 99.3, 100.6, 101.5, 102.9, 103.8, 105.5, 108.3],
                        '38': [85.6, 88.5, 90.2, 91.1, 92.5, 93.4, 94.8, 97.4, 99.9, 101.3, 102.2, 103.6, 104.5, 106.2, 109.1],
                        '39': [86.1, 89.1, 90.8, 91.7, 93.1, 94, 95.4, 98, 100.6, 102, 102.9, 104.3, 105.2, 106.9, 109.9],
                        '40': [86.6, 89.6, 91.3, 92.2, 93.7, 94.6, 96, 98.6, 101.3, 102.7, 103.6, 105, 105.9, 107.7, 110.6],
                        '41': [87.1, 90.1, 91.9, 92.8, 94.2, 95.2, 96.6, 99.2, 101.9, 103.3, 104.3, 105.7, 106.6, 108.4, 111.4],
                        '42': [87.6, 90.6, 92.4, 93.3, 94.8, 95.7, 97.2, 99.9, 102.5, 104, 104.9, 106.4, 107.3, 109.1, 112.1],
                        '43': [88.1, 91.1, 92.9, 93.9, 95.3, 96.3, 97.7, 100.4, 103.1, 104.6, 105.6, 107, 108, 109.8, 112.8],
                        '44': [88.5, 91.6, 93.4, 94.4, 95.9, 96.8, 98.3, 101, 103.8, 105.2, 106.2, 107.7, 108.6, 110.4, 113.5],
                        '45': [89, 92.1, 93.9, 94.9, 96.4, 97.4, 98.9, 101.6, 104.4, 105.8, 106.8, 108.3, 109.3, 111.1, 114.2],
                        '46': [89.5, 92.6, 94.4, 95.4, 96.9, 97.9, 99.4, 102.2, 105, 106.5, 107.5, 109, 109.9, 111.8, 114.9],
                        '47': [89.9, 93.1, 94.9, 95.9, 97.4, 98.5, 100, 102.8, 105.6, 107.1, 108.1, 109.6, 110.6, 112.4, 115.6],
                        '48': [90.4, 93.6, 95.4, 96.4, 98, 99, 100.5, 103.3, 106.2, 107.7, 108.7, 110.2, 111.2, 113.1, 116.3],
                        '49': [90.8, 94, 95.9, 96.9, 98.5, 99.5, 101, 103.9, 106.7, 108.3, 109.3, 110.8, 111.8, 113.7, 117],
                        '50': [91.3, 94.5, 96.4, 97.4, 99, 100, 101.6, 104.4, 107.3, 108.9, 109.9, 111.5, 112.5, 114.4, 117.6],
                        '51': [91.7, 95, 96.9, 97.9, 99.5, 100.5, 102.1, 105, 107.9, 109.5, 110.5, 112.1, 113.1, 115, 118.3],
                        '52': [92.1, 95.5, 97.4, 98.4, 100, 101.1, 102.6, 105.6, 108.5, 110.1, 111.1, 112.7, 113.7, 115.7, 119],
                        '53': [92.6, 95.9, 97.9, 98.9, 100.5, 101.6, 103.2, 106.1, 109.1, 110.7, 111.7, 113.3, 114.3, 116.3, 119.6],
                        '54': [93, 96.4, 98.4, 99.4, 101, 102.1, 103.7, 106.7, 109.6, 111.2, 112.3, 113.9, 115, 116.9, 120.3],
                        '55': [93.5, 96.9, 98.8, 99.9, 101.5, 102.6, 104.2, 107.2, 110.2, 111.8, 112.9, 114.5, 115.6, 117.6, 121],
                        '56': [93.9, 97.3, 99.3, 100.4, 102, 103.1, 104.7, 107.8, 110.8, 112.4, 113.5, 115.2, 116.2, 118.2, 121.6],
                        '57': [94.3, 97.8, 99.8, 100.9, 102.5, 103.6, 105.3, 108.3, 111.4, 113, 114.1, 115.8, 116.8, 118.8, 122.3],
                        '58': [94.8, 98.3, 100.3, 101.4, 103, 104.1, 105.8, 108.9, 111.9, 113.6, 114.7, 116.4, 117.4, 119.5, 123],
                        '59': [95.2, 98.7, 100.8, 101.9, 103.5, 104.7, 106.3, 109.4, 112.5, 114.2, 115.3, 117, 118.1, 120.1, 123.6],
                        '60': [95.6, 99.2, 101.2, 102.3, 104, 105.2, 106.8, 110, 113.1, 114.8, 115.9, 117.6, 118.7, 120.7, 124.3]


                    },
                    'girl': {
                        '0': [43.4, 44.8, 45.6, 46.1, 46.8, 47.2, 47.9, 49.1, 50.4, 51.1, 51.5, 52.2, 52.7, 53.5, 54.9],
                        '1': [47.6, 49.1, 50, 50.5, 51.2, 51.7, 52.4, 53.7, 55, 55.7, 56.2, 56.9, 57.4, 58.2, 59.7],
                        '2': [50.8, 52.3, 53.2, 53.7, 54.5, 55, 55.7, 57.1, 58.4, 59.2, 59.7, 60.4, 60.9, 61.8, 63.4],
                        '3': [53.3, 54.9, 55.8, 56.3, 57.1, 57.6, 58.4, 59.8, 61.2, 62, 62.5, 63.3, 63.8, 64.7, 66.3],
                        '4': [55.4, 57.1, 58, 58.5, 59.3, 59.8, 60.6, 62.1, 63.5, 64.3, 64.9, 65.7, 66.2, 67.1, 68.8],
                        '5': [57.2, 58.9, 59.9, 60.4, 61.2, 61.7, 62.5, 64, 65.5, 66.3, 66.9, 67.7, 68.2, 69.2, 70.9],
                        '6': [58.7, 60.5, 61.5, 62, 62.8, 63.4, 64.2, 65.7, 67.3, 68.1, 68.6, 69.5, 70, 71, 72.7],
                        '7': [60.1, 61.9, 62.9, 63.5, 64.3, 64.9, 65.7, 67.3, 68.8, 69.7, 70.3, 71.1, 71.6, 72.7, 74.4],
                        '8': [61.4, 63.2, 64.3, 64.9, 65.7, 66.3, 67.2, 68.7, 70.3, 71.2, 71.8, 72.6, 73.2, 74.3, 76.1],
                        '9': [62.7, 64.5, 65.6, 66.2, 67, 67.6, 68.5, 70.1, 71.8, 72.6, 73.2, 74.1, 74.7, 75.8, 77.6],
                        '10': [63.9, 65.7, 66.8, 67.4, 68.3, 68.9, 69.8, 71.5, 73.1, 74, 74.6, 75.5, 76.1, 77.2, 79.1],
                        '11': [65, 66.9, 68, 68.6, 69.5, 70.2, 71.1, 72.8, 74.5, 75.4, 76, 76.9, 77.5, 78.6, 80.6],
                        '12': [66.1, 68, 69.2, 69.8, 70.7, 71.3, 72.3, 74, 75.8, 76.7, 77.3, 78.3, 78.9, 80, 82],
                        '13': [67.1, 69.1, 70.3, 70.9, 71.8, 72.5, 73.4, 75.2, 77, 77.9, 78.6, 79.5, 80.2, 81.3, 83.3],
                        '14': [68.1, 70.1, 71.3, 72, 72.9, 73.6, 74.6, 76.4, 78.2, 79.2, 79.8, 80.8, 81.4, 82.6, 84.7],
                        '15': [69, 71.1, 72.4, 73, 74, 74.7, 75.7, 77.5, 79.4, 80.3, 81, 82, 82.7, 83.9, 86],
                        '16': [70, 72.1, 73.3, 74, 75, 75.7, 76.7, 78.6, 80.5, 81.5, 82.2, 83.2, 83.9, 85.1, 87.2],
                        '17': [70.9, 73, 74.3, 75, 76, 76.7, 77.7, 79.7, 81.6, 82.6, 83.3, 84.4, 85, 86.3, 88.5],
                        '18': [71.7, 74, 75.2, 75.9, 77, 77.7, 78.7, 80.7, 82.7, 83.7, 84.4, 85.5, 86.2, 87.5, 89.7],
                        '19': [72.6, 74.8, 76.2, 76.9, 77.9, 78.7, 79.7, 81.7, 83.7, 84.8, 85.5, 86.6, 87.3, 88.6, 90.9],
                        '20': [73.4, 75.7, 77, 77.7, 78.8, 79.6, 80.7, 82.7, 84.7, 85.8, 86.6, 87.7, 88.4, 89.7, 92],
                        '21': [74.2, 76.5, 77.9, 78.6, 79.7, 80.5, 81.6, 83.7, 85.7, 86.8, 87.6, 88.7, 89.4, 90.8, 93.1],
                        '22': [75, 77.3, 78.7, 79.5, 80.6, 81.4, 82.5, 84.6, 86.7, 87.8, 88.6, 89.7, 90.5, 91.9, 94.2],
                        '23': [75.7, 78.1, 79.6, 80.3, 81.5, 82.2, 83.4, 85.5, 87.7, 88.8, 89.6, 90.7, 91.5, 92.9, 95.3],
                        '24': [75.7, 78.2, 79.6, 80.4, 81.6, 82.4, 83.5, 85.7, 87.9, 89.1, 89.9, 91, 91.8, 93.2, 95.7],
                        '25': [76.5, 79, 80.4, 81.2, 82.4, 83.2, 84.4, 86.6, 88.8, 90, 90.8, 92, 92.8, 94.2, 96.7],
                        '26': [77.2, 79.7, 81.2, 82, 83.2, 84, 85.2, 87.4, 89.7, 90.9, 91.7, 92.9, 93.7, 95.2, 97.7],
                        '27': [77.8, 80.4, 81.9, 82.7, 83.9, 84.8, 86, 88.3, 90.6, 91.8, 92.6, 93.8, 94.6, 96.1, 98.7],
                        '28': [78.5, 81.1, 82.6, 83.5, 84.7, 85.5, 86.8, 89.1, 91.4, 92.7, 93.5, 94.7, 95.6, 97.1, 99.7],
                        '29': [79.1, 81.8, 83.4, 84.2, 85.4, 86.3, 87.6, 89.9, 92.2, 93.5, 94.4, 95.6, 96.4, 98, 100.7],
                        '30': [79.8, 82.5, 84, 84.9, 86.2, 87, 88.3, 90.7, 93.1, 94.3, 95.2, 96.5, 97.3, 98.9, 101.6],
                        '31': [80.4, 83.1, 84.7, 85.6, 86.9, 87.7, 89, 91.4, 93.9, 95.2, 96, 97.3, 98.2, 99.8, 102.5],
                        '32': [81, 83.8, 85.4, 86.2, 87.5, 88.4, 89.7, 92.2, 94.6, 95.9, 96.8, 98.2, 99, 100.6, 103.4],
                        '33': [81.6, 84.4, 86, 86.9, 88.2, 89.1, 90.4, 92.9, 95.4, 96.7, 97.6, 99, 99.8, 101.5, 104.3],
                        '34': [82.2, 85, 86.7, 87.5, 88.9, 89.8, 91.1, 93.6, 96.2, 97.5, 98.4, 99.8, 100.6, 102.3, 105.1],
                        '35': [82.7, 85.6, 87.3, 88.2, 89.5, 90.5, 91.8, 94.4, 96.9, 98.3, 99.2, 100.5, 101.4, 103.1, 106],
                        '36': [83.3, 86.2, 87.9, 88.8, 90.2, 91.1, 92.5, 95.1, 97.6, 99, 99.9, 101.3, 102.2, 103.9, 106.8],
                        '37': [83.8, 86.8, 88.5, 89.4, 90.8, 91.7, 93.1, 95.7, 98.3, 99.7, 100.7, 102.1, 103, 104.7, 107.6],
                        '38': [84.4, 87.4, 89.1, 90, 91.4, 92.4, 93.8, 96.4, 99, 100.5, 101.4, 102.8, 103.7, 105.5, 108.5],
                        '39': [84.9, 87.9, 89.7, 90.6, 92, 93, 94.4, 97.1, 99.7, 101.2, 102.1, 103.6, 104.5, 106.3, 109.3],
                        '40': [85.4, 88.5, 90.3, 91.2, 92.6, 93.6, 95.1, 97.7, 100.4, 101.9, 102.9, 104.3, 105.2, 107, 110.1],
                        '41': [86, 89, 90.8, 91.8, 93.2, 94.2, 95.7, 98.4, 101.1, 102.6, 103.6, 105, 106, 107.8, 110.8],
                        '42': [86.5, 89.6, 91.4, 92.4, 93.8, 94.8, 96.3, 99, 101.8, 103.3, 104.3, 105.7, 106.7, 108.5, 111.6],
                        '43': [87, 90.1, 92, 92.9, 94.4, 95.4, 96.9, 99.7, 102.4, 103.9, 104.9, 106.4, 107.4, 109.2, 112.4],
                        '44': [87.5, 90.7, 92.5, 93.5, 95, 96, 97.5, 100.3, 103.1, 104.6, 105.6, 107.1, 108.1, 110, 113.1],
                        '45': [88, 91.2, 93, 94, 95.6, 96.6, 98.1, 100.9, 103.7, 105.3, 106.3, 107.8, 108.8, 110.7, 113.9],
                        '46': [88.5, 91.7, 93.6, 94.6, 96.1, 97.2, 98.7, 101.5, 104.4, 105.9, 107, 108.5, 109.5, 111.4, 114.6],
                        '47': [88.9, 92.2, 94.1, 95.1, 96.7, 97.7, 99.3, 102.1, 105, 106.6, 107.6, 109.2, 110.2, 112.1, 115.3],
                        '48': [89.4, 92.7, 94.6, 95.6, 97.2, 98.3, 99.8, 102.7, 105.6, 107.2, 108.3, 109.8, 110.8, 112.8, 116],
                        '49': [89.9, 93.2, 95.1, 96.2, 97.8, 98.8, 100.4, 103.3, 106.3, 107.8, 108.9, 110.5, 111.5, 113.4, 116.7],
                        '50': [90.4, 93.7, 95.7, 96.7, 98.3, 99.4, 100.9, 103.9, 106.9, 108.4, 109.5, 111.1, 112.1, 114.1, 117.5],
                        '51': [90.8, 94.2, 96.2, 97.2, 98.8, 99.9, 101.5, 104.5, 107.5, 109.1, 110.1, 111.8, 112.8, 114.8, 118.1],
                        '52': [91.3, 94.7, 96.7, 97.7, 99.3, 100.4, 102, 105, 108.1, 109.7, 110.8, 112.4, 113.4, 115.4, 118.8],
                        '53': [91.7, 95.2, 97.2, 98.2, 99.9, 101, 102.6, 105.6, 108.6, 110.3, 111.4, 113, 114.1, 116.1, 119.5],
                        '54': [92.2, 95.6, 97.6, 98.7, 100.4, 101.5, 103.1, 106.2, 109.2, 110.9, 112, 113.6, 114.7, 116.7, 120.2],
                        '55': [92.6, 96.1, 98.1, 99.2, 100.9, 102, 103.6, 106.7, 109.8, 111.5, 112.6, 114.3, 115.3, 117.4, 120.9],
                        '56': [93, 96.6, 98.6, 99.7, 101.4, 102.5, 104.2, 107.3, 110.4, 112.1, 113.2, 114.9, 116, 118, 121.5],
                        '57': [93.5, 97, 99.1, 100.2, 101.9, 103, 104.7, 107.8, 111, 112.6, 113.8, 115.5, 116.6, 118.6, 122.2],
                        '58': [93.9, 97.5, 99.6, 100.7, 102.4, 103.5, 105.2, 108.4, 111.5, 113.2, 114.4, 116.1, 117.2, 119.3, 122.8],
                        '59': [94.3, 97.9, 100, 101.1, 102.8, 104, 105.7, 108.9, 112.1, 113.8, 114.9, 116.7, 117.8, 119.9, 123.5],
                        '60': [94.7, 98.4, 100.5, 101.6, 103.3, 104.5, 106.2, 109.4, 112.6, 114.4, 115.5, 117.2, 118.4, 120.5, 124.1]
                    }
                }

                // WHO zscore tables, source: http://www.who.int/childgrowth/standards
                zscoreTabls['boy'] = [
                    {
                        '45': [1.9, 2, 2.2, 2.4, 2.7, 3, 3.3],
                        '45.5': [1.9, 2.1, 2.3, 2.5, 2.8, 3.1, 3.4],
                        '46': [2, 2.2, 2.4, 2.6, 2.9, 3.1, 3.5],
                        '46.5': [2.1, 2.3, 2.5, 2.7, 3, 3.2, 3.6],
                        '47': [2.1, 2.3, 2.5, 2.8, 3, 3.3, 3.7],
                        '47.5': [2.2, 2.4, 2.6, 2.9, 3.1, 3.4, 3.8],
                        '48': [2.3, 2.5, 2.7, 2.9, 3.2, 3.6, 3.9],
                        '48.5': [2.3, 2.6, 2.8, 3, 3.3, 3.7, 4],
                        '49': [2.4, 2.6, 2.9, 3.1, 3.4, 3.8, 4.2],
                        '49.5': [2.5, 2.7, 3, 3.2, 3.5, 3.9, 4.3],
                        '50': [2.6, 2.8, 3, 3.3, 3.6, 4, 4.4],
                        '50.5': [2.7, 2.9, 3.1, 3.4, 3.8, 4.1, 4.5],
                        '51': [2.7, 3, 3.2, 3.5, 3.9, 4.2, 4.7],
                        '51.5': [2.8, 3.1, 3.3, 3.6, 4, 4.4, 4.8],
                        '52': [2.9, 3.2, 3.5, 3.8, 4.1, 4.5, 5],
                        '52.5': [3, 3.3, 3.6, 3.9, 4.2, 4.6, 5.1],
                        '53': [3.1, 3.4, 3.7, 4, 4.4, 4.8, 5.3],
                        '53.5': [3.2, 3.5, 3.8, 4.1, 4.5, 4.9, 5.4],
                        '54': [3.3, 3.6, 3.9, 4.3, 4.7, 5.1, 5.6],
                        '54.5': [3.4, 3.7, 4, 4.4, 4.8, 5.3, 5.8],
                        '55': [3.6, 3.8, 4.2, 4.5, 5, 5.4, 6],
                        '55.5': [3.7, 4, 4.3, 4.7, 5.1, 5.6, 6.1],
                        '56': [3.8, 4.1, 4.4, 4.8, 5.3, 5.8, 6.3],
                        '56.5': [3.9, 4.2, 4.6, 5, 5.4, 5.9, 6.5],
                        '57': [4, 4.3, 4.7, 5.1, 5.6, 6.1, 6.7],
                        '57.5': [4.1, 4.5, 4.9, 5.3, 5.7, 6.3, 6.9],
                        '58': [4.3, 4.6, 5, 5.4, 5.9, 6.4, 7.1],
                        '58.5': [4.4, 4.7, 5.1, 5.6, 6.1, 6.6, 7.2],
                        '59': [4.5, 4.8, 5.3, 5.7, 6.2, 6.8, 7.4],
                        '59.5': [4.6, 5, 5.4, 5.9, 6.4, 7, 7.6],
                        '60': [4.7, 5.1, 5.5, 6, 6.5, 7.1, 7.8],
                        '60.5': [4.8, 5.2, 5.6, 6.1, 6.7, 7.3, 8],
                        '61': [4.9, 5.3, 5.8, 6.3, 6.8, 7.4, 8.1],
                        '61.5': [5, 5.4, 5.9, 6.4, 7, 7.6, 8.3],
                        '62': [5.1, 5.6, 6, 6.5, 7.1, 7.7, 8.5],
                        '62.5': [5.2, 5.7, 6.1, 6.7, 7.2, 7.9, 8.6],
                        '63': [5.3, 5.8, 6.2, 6.8, 7.4, 8, 8.8],
                        '63.5': [5.4, 5.9, 6.4, 6.9, 7.5, 8.2, 8.9],
                        '64': [5.5, 6, 6.5, 7, 7.6, 8.3, 9.1],
                        '64.5': [5.6, 6.1, 6.6, 7.1, 7.8, 8.5, 9.3],
                        '65': [5.7, 6.2, 6.7, 7.3, 7.9, 8.6, 9.4],
                        '65.5': [5.8, 6.3, 6.8, 7.4, 8, 8.7, 9.6],
                        '66': [5.9, 6.4, 6.9, 7.5, 8.2, 8.9, 9.7],
                        '66.5': [6, 6.5, 7, 7.6, 8.3, 9, 9.9],
                        '67': [6.1, 6.6, 7.1, 7.7, 8.4, 9.2, 10],
                        '67.5': [6.2, 6.7, 7.2, 7.9, 8.5, 9.3, 10.2],
                        '68': [6.3, 6.8, 7.3, 8, 8.7, 9.4, 10.3],
                        '68.5': [6.4, 6.9, 7.5, 8.1, 8.8, 9.6, 10.5],
                        '69': [6.5, 7, 7.6, 8.2, 8.9, 9.7, 10.6],
                        '69.5': [6.6, 7.1, 7.7, 8.3, 9, 9.8, 10.8],
                        '70': [6.6, 7.2, 7.8, 8.4, 9.2, 10, 10.9],
                        '70.5': [6.7, 7.3, 7.9, 8.5, 9.3, 10.1, 11.1],
                        '71': [6.8, 7.4, 8, 8.6, 9.4, 10.2, 11.2],
                        '71.5': [6.9, 7.5, 8.1, 8.8, 9.5, 10.4, 11.3],
                        '72': [7, 7.6, 8.2, 8.9, 9.6, 10.5, 11.5],
                        '72.5': [7.1, 7.6, 8.3, 9, 9.8, 10.6, 11.6],
                        '73': [7.2, 7.7, 8.4, 9.1, 9.9, 10.8, 11.8],
                        '73.5': [7.2, 7.8, 8.5, 9.2, 10, 10.9, 11.9],
                        '74': [7.3, 7.9, 8.6, 9.3, 10.1, 11, 12.1],
                        '74.5': [7.4, 8, 8.7, 9.4, 10.2, 11.2, 12.2],
                        '75': [7.5, 8.1, 8.8, 9.5, 10.3, 11.3, 12.3],
                        '75.5': [7.6, 8.2, 8.8, 9.6, 10.4, 11.4, 12.5],
                        '76': [7.6, 8.3, 8.9, 9.7, 10.6, 11.5, 12.6],
                        '76.5': [7.7, 8.3, 9, 9.8, 10.7, 11.6, 12.7],
                        '77': [7.8, 8.4, 9.1, 9.9, 10.8, 11.7, 12.8],
                        '77.5': [7.9, 8.5, 9.2, 10, 10.9, 11.9, 13],
                        '78': [7.9, 8.6, 9.3, 10.1, 11, 12, 13.1],
                        '78.5': [8, 8.7, 9.4, 10.2, 11.1, 12.1, 13.2],
                        '79': [8.1, 8.7, 9.5, 10.3, 11.2, 12.2, 13.3],
                        '79.5': [8.2, 8.8, 9.5, 10.4, 11.3, 12.3, 13.4],
                        '80': [8.2, 8.9, 9.6, 10.4, 11.4, 12.4, 13.6],
                        '80.5': [8.3, 9, 9.7, 10.5, 11.5, 12.5, 13.7],
                        '81': [8.4, 9.1, 9.8, 10.6, 11.6, 12.6, 13.8],
                        '81.5': [8.5, 9.1, 9.9, 10.7, 11.7, 12.7, 13.9],
                        '82': [8.5, 9.2, 10, 10.8, 11.8, 12.8, 14],
                        '82.5': [8.6, 9.3, 10.1, 10.9, 11.9, 13, 14.2],
                        '83': [8.7, 9.4, 10.2, 11, 12, 13.1, 14.3],
                        '83.5': [8.8, 9.5, 10.3, 11.2, 12.1, 13.2, 14.4],
                        '84': [8.9, 9.6, 10.4, 11.3, 12.2, 13.3, 14.6],
                        '84.5': [9, 9.7, 10.5, 11.4, 12.4, 13.5, 14.7],
                        '85': [9.1, 9.8, 10.6, 11.5, 12.5, 13.6, 14.9],
                        '85.5': [9.2, 9.9, 10.7, 11.6, 12.6, 13.7, 15],
                        '86': [9.3, 10, 10.8, 11.7, 12.8, 13.9, 15.2],
                        '86.5': [9.4, 10.1, 11, 11.9, 12.9, 14, 15.3],
                        '87': [9.5, 10.2, 11.1, 12, 13, 14.2, 15.5],
                        '87.5': [9.6, 10.4, 11.2, 12.1, 13.2, 14.3, 15.6],
                        '88': [9.7, 10.5, 11.3, 12.2, 13.3, 14.5, 15.8],
                        '88.5': [9.8, 10.6, 11.4, 12.4, 13.4, 14.6, 15.9],
                        '89': [9.9, 10.7, 11.5, 12.5, 13.5, 14.7, 16.1],
                        '89.5': [10, 10.8, 11.6, 12.6, 13.7, 14.9, 16.2],
                        '90': [10.1, 10.9, 11.8, 12.7, 13.8, 15, 16.4],
                        '90.5': [10.2, 11, 11.9, 12.8, 13.9, 15.1, 16.5],
                        '91': [10.3, 11.1, 12, 13, 14.1, 15.3, 16.7],
                        '91.5': [10.4, 11.2, 12.1, 13.1, 14.2, 15.4, 16.8],
                        '92': [10.5, 11.3, 12.2, 13.2, 14.3, 15.6, 17],
                        '92.5': [10.6, 11.4, 12.3, 13.3, 14.4, 15.7, 17.1],
                        '93': [10.7, 11.5, 12.4, 13.4, 14.6, 15.8, 17.3],
                        '93.5': [10.7, 11.6, 12.5, 13.5, 14.7, 16, 17.4],
                        '94': [10.8, 11.7, 12.6, 13.7, 14.8, 16.1, 17.6],
                        '94.5': [10.9, 11.8, 12.7, 13.8, 14.9, 16.3, 17.7],
                        '95': [11, 11.9, 12.8, 13.9, 15.1, 16.4, 17.9],
                        '95.5': [11.1, 12, 12.9, 14, 15.2, 16.5, 18],
                        '96': [11.2, 12.1, 13.1, 14.1, 15.3, 16.7, 18.2],
                        '96.5': [11.3, 12.2, 13.2, 14.3, 15.5, 16.8, 18.4],
                        '97': [11.4, 12.3, 13.3, 14.4, 15.6, 17, 18.5],
                        '97.5': [11.5, 12.4, 13.4, 14.5, 15.7, 17.1, 18.7],
                        '98': [11.6, 12.5, 13.5, 14.6, 15.9, 17.3, 18.9],
                        '98.5': [11.7, 12.6, 13.6, 14.8, 16, 17.5, 19.1],
                        '99': [11.8, 12.7, 13.7, 14.9, 16.2, 17.6, 19.2],
                        '99.5': [11.9, 12.8, 13.9, 15, 16.3, 17.8, 19.4],
                        '100': [12, 12.9, 14, 15.2, 16.5, 18, 19.6],
                        '100.5': [12.1, 13, 14.1, 15.3, 16.6, 18.1, 19.8],
                        '101': [12.2, 13.2, 14.2, 15.4, 16.8, 18.3, 20],
                        '101.5': [12.3, 13.3, 14.4, 15.6, 16.9, 18.5, 20.2],
                        '102': [12.4, 13.4, 14.5, 15.7, 17.1, 18.7, 20.4],
                        '102.5': [12.5, 13.5, 14.6, 15.9, 17.3, 18.8, 20.6],
                        '103': [12.6, 13.6, 14.8, 16, 17.4, 19, 20.8],
                        '103.5': [12.7, 13.7, 14.9, 16.2, 17.6, 19.2, 21],
                        '104': [12.8, 13.9, 15, 16.3, 17.8, 19.4, 21.2],
                        '104.5': [12.9, 14, 15.2, 16.5, 17.9, 19.6, 21.5],
                        '105': [13, 14.1, 15.3, 16.6, 18.1, 19.8, 21.7],
                        '105.5': [13.2, 14.2, 15.4, 16.8, 18.3, 20, 21.9],
                        '106': [13.3, 14.4, 15.6, 16.9, 18.5, 20.2, 22.1],
                        '106.5': [13.4, 14.5, 15.7, 17.1, 18.6, 20.4, 22.4],
                        '107': [13.5, 14.6, 15.9, 17.3, 18.8, 20.6, 22.6],
                        '107.5': [13.6, 14.7, 16, 17.4, 19, 20.8, 22.8],
                        '108': [13.7, 14.9, 16.2, 17.6, 19.2, 21, 23.1],
                        '108.5': [13.8, 15, 16.3, 17.8, 19.4, 21.2, 23.3],
                        '109': [14, 15.1, 16.5, 17.9, 19.6, 21.4, 23.6],
                        '109.5': [14.1, 15.3, 16.6, 18.1, 19.8, 21.7, 23.8],
                        '110': [14.2, 15.4, 16.8, 18.3, 20, 21.9, 24.1],
                    },
                    {
                        '65': [5.9, 6.3, 6.9, 7.4, 8.1, 8.8, 9.6],
                        '65.5': [6, 6.4, 7, 7.6, 8.2, 8.9, 9.8],
                        '66': [6.1, 6.5, 7.1, 7.7, 8.3, 9.1, 9.9],
                        '66.5': [6.1, 6.6, 7.2, 7.8, 8.5, 9.2, 10.1],
                        '67': [6.2, 6.7, 7.3, 7.9, 8.6, 9.4, 10.2],
                        '67.5': [6.3, 6.8, 7.4, 8, 8.7, 9.5, 10.4],
                        '68': [6.4, 6.9, 7.5, 8.1, 8.8, 9.6, 10.5],
                        '68.5': [6.5, 7, 7.6, 8.2, 9, 9.8, 10.7],
                        '69': [6.6, 7.1, 7.7, 8.4, 9.1, 9.9, 10.8],
                        '69.5': [6.7, 7.2, 7.8, 8.5, 9.2, 10, 11],
                        '70': [6.8, 7.3, 7.9, 8.6, 9.3, 10.2, 11.1],
                        '70.5': [6.9, 7.4, 8, 8.7, 9.5, 10.3, 11.3],
                        '71': [6.9, 7.5, 8.1, 8.8, 9.6, 10.4, 11.4],
                        '71.5': [7, 7.6, 8.2, 8.9, 9.7, 10.6, 11.6],
                        '72': [7.1, 7.7, 8.3, 9, 9.8, 10.7, 11.7],
                        '72.5': [7.2, 7.8, 8.4, 9.1, 9.9, 10.8, 11.8],
                        '73': [7.3, 7.9, 8.5, 9.2, 10, 11, 12],
                        '73.5': [7.4, 7.9, 8.6, 9.3, 10.2, 11.1, 12.1],
                        '74': [7.4, 8, 8.7, 9.4, 10.3, 11.2, 12.2],
                        '74.5': [7.5, 8.1, 8.8, 9.5, 10.4, 11.3, 12.4],
                        '75': [7.6, 8.2, 8.9, 9.6, 10.5, 11.4, 12.5],
                        '75.5': [7.7, 8.3, 9, 9.7, 10.6, 11.6, 12.6],
                        '76': [7.7, 8.4, 9.1, 9.8, 10.7, 11.7, 12.8],
                        '76.5': [7.8, 8.5, 9.2, 9.9, 10.8, 11.8, 12.9],
                        '77': [7.9, 8.5, 9.2, 10, 10.9, 11.9, 13],
                        '77.5': [8, 8.6, 9.3, 10.1, 11, 12, 13.1],
                        '78': [8, 8.7, 9.4, 10.2, 11.1, 12.1, 13.3],
                        '78.5': [8.1, 8.8, 9.5, 10.3, 11.2, 12.2, 13.4],
                        '79': [8.2, 8.8, 9.6, 10.4, 11.3, 12.3, 13.5],
                        '79.5': [8.3, 8.9, 9.7, 10.5, 11.4, 12.4, 13.6],
                        '80': [8.3, 9, 9.7, 10.6, 11.5, 12.6, 13.7],
                        '80.5': [8.4, 9.1, 9.8, 10.7, 11.6, 12.7, 13.8],
                        '81': [8.5, 9.2, 9.9, 10.8, 11.7, 12.8, 14],
                        '81.5': [8.6, 9.3, 10, 10.9, 11.8, 12.9, 14.1],
                        '82': [8.7, 9.3, 10.1, 11, 11.9, 13, 14.2],
                        '82.5': [8.7, 9.4, 10.2, 11.1, 12.1, 13.1, 14.4],
                        '83': [8.8, 9.5, 10.3, 11.2, 12.2, 13.3, 14.5],
                        '83.5': [8.9, 9.6, 10.4, 11.3, 12.3, 13.4, 14.6],
                        '84': [9, 9.7, 10.5, 11.4, 12.4, 13.5, 14.8],
                        '84.5': [9.1, 9.9, 10.7, 11.5, 12.5, 13.7, 14.9],
                        '85': [9.2, 10, 10.8, 11.7, 12.7, 13.8, 15.1],
                        '85.5': [9.3, 10.1, 10.9, 11.8, 12.8, 13.9, 15.2],
                        '86': [9.4, 10.2, 11, 11.9, 12.9, 14.1, 15.4],
                        '86.5': [9.5, 10.3, 11.1, 12, 13.1, 14.2, 15.5],
                        '87': [9.6, 10.4, 11.2, 12.2, 13.2, 14.4, 15.7],
                        '87.5': [9.7, 10.5, 11.3, 12.3, 13.3, 14.5, 15.8],
                        '88': [9.8, 10.6, 11.5, 12.4, 13.5, 14.7, 16],
                        '88.5': [9.9, 10.7, 11.6, 12.5, 13.6, 14.8, 16.1],
                        '89': [10, 10.8, 11.7, 12.6, 13.7, 14.9, 16.3],
                        '89.5': [10.1, 10.9, 11.8, 12.8, 13.9, 15.1, 16.4],
                        '90': [10.2, 11, 11.9, 12.9, 14, 15.2, 16.6],
                        '90.5': [10.3, 11.1, 12, 13, 14.1, 15.3, 16.7],
                        '91': [10.4, 11.2, 12.1, 13.1, 14.2, 15.5, 16.9],
                        '91.5': [10.5, 11.3, 12.2, 13.2, 14.4, 15.6, 17],
                        '92': [10.6, 11.4, 12.3, 13.4, 14.5, 15.8, 17.2],
                        '92.5': [10.7, 11.5, 12.4, 13.5, 14.6, 15.9, 17.3],
                        '93': [10.8, 11.6, 12.6, 13.6, 14.7, 16, 17.5],
                        '93.5': [10.9, 11.7, 12.7, 13.7, 14.9, 16.2, 17.6],
                        '94': [11, 11.8, 12.8, 13.8, 15, 16.3, 17.8],
                        '94.5': [11.1, 11.9, 12.9, 13.9, 15.1, 16.5, 17.9],
                        '95': [11.1, 12, 13, 14.1, 15.3, 16.6, 18.1],
                        '95.5': [11.2, 12.1, 13.1, 14.2, 15.4, 16.7, 18.3],
                        '96': [11.3, 12.2, 13.2, 14.3, 15.5, 16.9, 18.4],
                        '96.5': [11.4, 12.3, 13.3, 14.4, 15.7, 17, 18.6],
                        '97': [11.5, 12.4, 13.4, 14.6, 15.8, 17.2, 18.8],
                        '97.5': [11.6, 12.5, 13.6, 14.7, 15.9, 17.4, 18.9],
                        '98': [11.7, 12.6, 13.7, 14.8, 16.1, 17.5, 19.1],
                        '98.5': [11.8, 12.8, 13.8, 14.9, 16.2, 17.7, 19.3],
                        '99': [11.9, 12.9, 13.9, 15.1, 16.4, 17.9, 19.5],
                        '99.5': [12, 13, 14, 15.2, 16.5, 18, 19.7],
                        '100': [12.1, 13.1, 14.2, 15.4, 16.7, 18.2, 19.9],
                        '100.5': [12.2, 13.2, 14.3, 15.5, 16.9, 18.4, 20.1],
                        '101': [12.3, 13.3, 14.4, 15.6, 17, 18.5, 20.3],
                        '101.5': [12.4, 13.4, 14.5, 15.8, 17.2, 18.7, 20.5],
                        '102': [12.5, 13.6, 14.7, 15.9, 17.3, 18.9, 20.7],
                        '102.5': [12.6, 13.7, 14.8, 16.1, 17.5, 19.1, 20.9],
                        '103': [12.8, 13.8, 14.9, 16.2, 17.7, 19.3, 21.1],
                        '103.5': [12.9, 13.9, 15.1, 16.4, 17.8, 19.5, 21.3],
                        '104': [13, 14, 15.2, 16.5, 18, 19.7, 21.6],
                        '104.5': [13.1, 14.2, 15.4, 16.7, 18.2, 19.9, 21.8],
                        '105': [13.2, 14.3, 15.5, 16.8, 18.4, 20.1, 22],
                        '105.5': [13.3, 14.4, 15.6, 17, 18.5, 20.3, 22.2],
                        '106': [13.4, 14.5, 15.8, 17.2, 18.7, 20.5, 22.5],
                        '106.5': [13.5, 14.7, 15.9, 17.3, 18.9, 20.7, 22.7],
                        '107': [13.7, 14.8, 16.1, 17.5, 19.1, 20.9, 22.9],
                        '107.5': [13.8, 14.9, 16.2, 17.7, 19.3, 21.1, 23.2],
                        '108': [13.9, 15.1, 16.4, 17.8, 19.5, 21.3, 23.4],
                        '108.5': [14, 15.2, 16.5, 18, 19.7, 21.5, 23.7],
                        '109': [14.1, 15.3, 16.7, 18.2, 19.8, 21.8, 23.9],
                        '109.5': [14.3, 15.5, 16.8, 18.3, 20, 22, 24.2],
                        '110': [14.4, 15.6, 17, 18.5, 20.2, 22.2, 24.4],
                        '110.5': [14.5, 15.8, 17.1, 18.7, 20.4, 22.4, 24.7],
                        '111': [14.6, 15.9, 17.3, 18.9, 20.7, 22.7, 25],
                        '111.5': [14.8, 16, 17.5, 19.1, 20.9, 22.9, 25.2],
                        '112': [14.9, 16.2, 17.6, 19.2, 21.1, 23.1, 25.5],
                        '112.5': [15, 16.3, 17.8, 19.4, 21.3, 23.4, 25.8],
                        '113': [15.2, 16.5, 18, 19.6, 21.5, 23.6, 26],
                        '113.5': [15.3, 16.6, 18.1, 19.8, 21.7, 23.9, 26.3],
                        '114': [15.4, 16.8, 18.3, 20, 21.9, 24.1, 26.6],
                        '114.5': [15.6, 16.9, 18.5, 20.2, 22.1, 24.4, 26.9],
                        '115': [15.7, 17.1, 18.6, 20.4, 22.4, 24.6, 27.2],
                        '115.5': [15.8, 17.2, 18.8, 20.6, 22.6, 24.9, 27.5],
                        '116': [16, 17.4, 19, 20.8, 22.8, 25.1, 27.8],
                        '116.5': [16.1, 17.5, 19.2, 21, 23, 25.4, 28],
                        '117': [16.2, 17.7, 19.3, 21.2, 23.3, 25.6, 28.3],
                        '117.5': [16.4, 17.9, 19.5, 21.4, 23.5, 25.9, 28.6],
                        '118': [16.5, 18, 19.7, 21.6, 23.7, 26.1, 28.9],
                        '118.5': [16.7, 18.2, 19.9, 21.8, 23.9, 26.4, 29.2],
                        '119': [16.8, 18.3, 20, 22, 24.1, 26.6, 29.5],
                        '119.5': [16.9, 18.5, 20.2, 22.2, 24.4, 26.9, 29.8],
                        '120': [17.1, 18.6, 20.4, 22.4, 24.6, 27.2, 30.1],
                    },
                ]

                zscoreTabls['girl'] = [
                    {
                        '45': [1.9, 2.1, 2.3, 2.5, 2.7, 3, 3.3],
                        '45.5': [2, 2.1, 2.3, 2.5, 2.8, 3.1, 3.4],
                        '46': [2, 2.2, 2.4, 2.6, 2.9, 3.2, 3.5],
                        '46.5': [2.1, 2.3, 2.5, 2.7, 3, 3.3, 3.6],
                        '47': [2.2, 2.4, 2.6, 2.8, 3.1, 3.4, 3.7],
                        '47.5': [2.2, 2.4, 2.6, 2.9, 3.2, 3.5, 3.8],
                        '48': [2.3, 2.5, 2.7, 3, 3.3, 3.6, 4],
                        '48.5': [2.4, 2.6, 2.8, 3.1, 3.4, 3.7, 4.1],
                        '49': [2.4, 2.6, 2.9, 3.2, 3.5, 3.8, 4.2],
                        '49.5': [2.5, 2.7, 3, 3.3, 3.6, 3.9, 4.3],
                        '50': [2.6, 2.8, 3.1, 3.4, 3.7, 4, 4.5],
                        '50.5': [2.7, 2.9, 3.2, 3.5, 3.8, 4.2, 4.6],
                        '51': [2.8, 3, 3.3, 3.6, 3.9, 4.3, 4.8],
                        '51.5': [2.8, 3.1, 3.4, 3.7, 4, 4.4, 4.9],
                        '52': [2.9, 3.2, 3.5, 3.8, 4.2, 4.6, 5.1],
                        '52.5': [3, 3.3, 3.6, 3.9, 4.3, 4.7, 5.2],
                        '53': [3.1, 3.4, 3.7, 4, 4.4, 4.9, 5.4],
                        '53.5': [3.2, 3.5, 3.8, 4.2, 4.6, 5, 5.5],
                        '54': [3.3, 3.6, 3.9, 4.3, 4.7, 5.2, 5.7],
                        '54.5': [3.4, 3.7, 4, 4.4, 4.8, 5.3, 5.9],
                        '55': [3.5, 3.8, 4.2, 4.5, 5, 5.5, 6.1],
                        '55.5': [3.6, 3.9, 4.3, 4.7, 5.1, 5.7, 6.3],
                        '56': [3.7, 4, 4.4, 4.8, 5.3, 5.8, 6.4],
                        '56.5': [3.8, 4.1, 4.5, 5, 5.4, 6, 6.6],
                        '57': [3.9, 4.3, 4.6, 5.1, 5.6, 6.1, 6.8],
                        '57.5': [4, 4.4, 4.8, 5.2, 5.7, 6.3, 7],
                        '58': [4.1, 4.5, 4.9, 5.4, 5.9, 6.5, 7.1],
                        '58.5': [4.2, 4.6, 5, 5.5, 6, 6.6, 7.3],
                        '59': [4.3, 4.7, 5.1, 5.6, 6.2, 6.8, 7.5],
                        '59.5': [4.4, 4.8, 5.3, 5.7, 6.3, 6.9, 7.7],
                        '60': [4.5, 4.9, 5.4, 5.9, 6.4, 7.1, 7.8],
                        '60.5': [4.6, 5, 5.5, 6, 6.6, 7.3, 8],
                        '61': [4.7, 5.1, 5.6, 6.1, 6.7, 7.4, 8.2],
                        '61.5': [4.8, 5.2, 5.7, 6.3, 6.9, 7.6, 8.4],
                        '62': [4.9, 5.3, 5.8, 6.4, 7, 7.7, 8.5],
                        '62.5': [5, 5.4, 5.9, 6.5, 7.1, 7.8, 8.7],
                        '63': [5.1, 5.5, 6, 6.6, 7.3, 8, 8.8],
                        '63.5': [5.2, 5.6, 6.2, 6.7, 7.4, 8.1, 9],
                        '64': [5.3, 5.7, 6.3, 6.9, 7.5, 8.3, 9.1],
                        '64.5': [5.4, 5.8, 6.4, 7, 7.6, 8.4, 9.3],
                        '65': [5.5, 5.9, 6.5, 7.1, 7.8, 8.6, 9.5],
                        '65.5': [5.5, 6, 6.6, 7.2, 7.9, 8.7, 9.6],
                        '66': [5.6, 6.1, 6.7, 7.3, 8, 8.8, 9.8],
                        '66.5': [5.7, 6.2, 6.8, 7.4, 8.1, 9, 9.9],
                        '67': [5.8, 6.3, 6.9, 7.5, 8.3, 9.1, 10],
                        '67.5': [5.9, 6.4, 7, 7.6, 8.4, 9.2, 10.2],
                        '68': [6, 6.5, 7.1, 7.7, 8.5, 9.4, 10.3],
                        '68.5': [6.1, 6.6, 7.2, 7.9, 8.6, 9.5, 10.5],
                        '69': [6.1, 6.7, 7.3, 8, 8.7, 9.6, 10.6],
                        '69.5': [6.2, 6.8, 7.4, 8.1, 8.8, 9.7, 10.7],
                        '70': [6.3, 6.9, 7.5, 8.2, 9, 9.9, 10.9],
                        '70.5': [6.4, 6.9, 7.6, 8.3, 9.1, 10, 11],
                        '71': [6.5, 7, 7.7, 8.4, 9.2, 10.1, 11.1],
                        '71.5': [6.5, 7.1, 7.7, 8.5, 9.3, 10.2, 11.3],
                        '72': [6.6, 7.2, 7.8, 8.6, 9.4, 10.3, 11.4],
                        '72.5': [6.7, 7.3, 7.9, 8.7, 9.5, 10.5, 11.5],
                        '73': [6.8, 7.4, 8, 8.8, 9.6, 10.6, 11.7],
                        '73.5': [6.9, 7.4, 8.1, 8.9, 9.7, 10.7, 11.8],
                        '74': [6.9, 7.5, 8.2, 9, 9.8, 10.8, 11.9],
                        '74.5': [7, 7.6, 8.3, 9.1, 9.9, 10.9, 12],
                        '75': [7.1, 7.7, 8.4, 9.1, 10, 11, 12.2],
                        '75.5': [7.1, 7.8, 8.5, 9.2, 10.1, 11.1, 12.3],
                        '76': [7.2, 7.8, 8.5, 9.3, 10.2, 11.2, 12.4],
                        '76.5': [7.3, 7.9, 8.6, 9.4, 10.3, 11.4, 12.5],
                        '77': [7.4, 8, 8.7, 9.5, 10.4, 11.5, 12.6],
                        '77.5': [7.4, 8.1, 8.8, 9.6, 10.5, 11.6, 12.8],
                        '78': [7.5, 8.2, 8.9, 9.7, 10.6, 11.7, 12.9],
                        '78.5': [7.6, 8.2, 9, 9.8, 10.7, 11.8, 13],
                        '79': [7.7, 8.3, 9.1, 9.9, 10.8, 11.9, 13.1],
                        '79.5': [7.7, 8.4, 9.1, 10, 10.9, 12, 13.3],
                        '80': [7.8, 8.5, 9.2, 10.1, 11, 12.1, 13.4],
                        '80.5': [7.9, 8.6, 9.3, 10.2, 11.2, 12.3, 13.5],
                        '81': [8, 8.7, 9.4, 10.3, 11.3, 12.4, 13.7],
                        '81.5': [8.1, 8.8, 9.5, 10.4, 11.4, 12.5, 13.8],
                        '82': [8.1, 8.8, 9.6, 10.5, 11.5, 12.6, 13.9],
                        '82.5': [8.2, 8.9, 9.7, 10.6, 11.6, 12.8, 14.1],
                        '83': [8.3, 9, 9.8, 10.7, 11.8, 12.9, 14.2],
                        '83.5': [8.4, 9.1, 9.9, 10.9, 11.9, 13.1, 14.4],
                        '84': [8.5, 9.2, 10.1, 11, 12, 13.2, 14.5],
                        '84.5': [8.6, 9.3, 10.2, 11.1, 12.1, 13.3, 14.7],
                        '85': [8.7, 9.4, 10.3, 11.2, 12.3, 13.5, 14.9],
                        '85.5': [8.8, 9.5, 10.4, 11.3, 12.4, 13.6, 15],
                        '86': [8.9, 9.7, 10.5, 11.5, 12.6, 13.8, 15.2],
                        '86.5': [9, 9.8, 10.6, 11.6, 12.7, 13.9, 15.4],
                        '87': [9.1, 9.9, 10.7, 11.7, 12.8, 14.1, 15.5],
                        '87.5': [9.2, 10, 10.9, 11.8, 13, 14.2, 15.7],
                        '88': [9.3, 10.1, 11, 12, 13.1, 14.4, 15.9],
                        '88.5': [9.4, 10.2, 11.1, 12.1, 13.2, 14.5, 16],
                        '89': [9.5, 10.3, 11.2, 12.2, 13.4, 14.7, 16.2],
                        '89.5': [9.6, 10.4, 11.3, 12.3, 13.5, 14.8, 16.4],
                        '90': [9.7, 10.5, 11.4, 12.5, 13.7, 15, 16.5],
                        '90.5': [9.8, 10.6, 11.5, 12.6, 13.8, 15.1, 16.7],
                        '91': [9.9, 10.7, 11.7, 12.7, 13.9, 15.3, 16.9],
                        '91.5': [10, 10.8, 11.8, 12.8, 14.1, 15.5, 17],
                        '92': [10.1, 10.9, 11.9, 13, 14.2, 15.6, 17.2],
                        '92.5': [10.1, 11, 12, 13.1, 14.3, 15.8, 17.4],
                        '93': [10.2, 11.1, 12.1, 13.2, 14.5, 15.9, 17.5],
                        '93.5': [10.3, 11.2, 12.2, 13.3, 14.6, 16.1, 17.7],
                        '94': [10.4, 11.3, 12.3, 13.5, 14.7, 16.2, 17.9],
                        '94.5': [10.5, 11.4, 12.4, 13.6, 14.9, 16.4, 18],
                        '95': [10.6, 11.5, 12.6, 13.7, 15, 16.5, 18.2],
                        '95.5': [10.7, 11.6, 12.7, 13.8, 15.2, 16.7, 18.4],
                        '96': [10.8, 11.7, 12.8, 14, 15.3, 16.8, 18.6],
                        '96.5': [10.9, 11.8, 12.9, 14.1, 15.4, 17, 18.7],
                        '97': [11, 12, 13, 14.2, 15.6, 17.1, 18.9],
                        '97.5': [11.1, 12.1, 13.1, 14.4, 15.7, 17.3, 19.1],
                        '98': [11.2, 12.2, 13.3, 14.5, 15.9, 17.5, 19.3],
                        '98.5': [11.3, 12.3, 13.4, 14.6, 16, 17.6, 19.5],
                        '99': [11.4, 12.4, 13.5, 14.8, 16.2, 17.8, 19.6],
                        '99.5': [11.5, 12.5, 13.6, 14.9, 16.3, 18, 19.8],
                        '100': [11.6, 12.6, 13.7, 15, 16.5, 18.1, 20],
                        '100.5': [11.7, 12.7, 13.9, 15.2, 16.6, 18.3, 20.2],
                        '101': [11.8, 12.8, 14, 15.3, 16.8, 18.5, 20.4],
                        '101.5': [11.9, 13, 14.1, 15.5, 17, 18.7, 20.6],
                        '102': [12, 13.1, 14.3, 15.6, 17.1, 18.9, 20.8],
                        '102.5': [12.1, 13.2, 14.4, 15.8, 17.3, 19, 21],
                        '103': [12.3, 13.3, 14.5, 15.9, 17.5, 19.2, 21.3],
                        '103.5': [12.4, 13.5, 14.7, 16.1, 17.6, 19.4, 21.5],
                        '104': [12.5, 13.6, 14.8, 16.2, 17.8, 19.6, 21.7],
                        '104.5': [12.6, 13.7, 15, 16.4, 18, 19.8, 21.9],
                        '105': [12.7, 13.8, 15.1, 16.5, 18.2, 20, 22.2],
                        '105.5': [12.8, 14, 15.3, 16.7, 18.4, 20.2, 22.4],
                        '106': [13, 14.1, 15.4, 16.9, 18.5, 20.5, 22.6],
                        '106.5': [13.1, 14.3, 15.6, 17.1, 18.7, 20.7, 22.9],
                        '107': [13.2, 14.4, 15.7, 17.2, 18.9, 20.9, 23.1],
                        '107.5': [13.3, 14.5, 15.9, 17.4, 19.1, 21.1, 23.4],
                        '108': [13.5, 14.7, 16, 17.6, 19.3, 21.3, 23.6],
                        '108.5': [13.6, 14.8, 16.2, 17.8, 19.5, 21.6, 23.9],
                        '109': [13.7, 15, 16.4, 18, 19.7, 21.8, 24.2],
                        '109.5': [13.9, 15.1, 16.5, 18.1, 20, 22, 24.4],
                        '110': [14, 15.3, 16.7, 18.3, 20.2, 22.3, 24.7],

                    },
                    {
                        '65': [5.6, 6.1, 6.6, 7.2, 7.9, 8.7, 9.7],
                        '65.5': [5.7, 6.2, 6.7, 7.4, 8.1, 8.9, 9.8],
                        '66': [5.8, 6.3, 6.8, 7.5, 8.2, 9, 10],
                        '66.5': [5.8, 6.4, 6.9, 7.6, 8.3, 9.1, 10.1],
                        '67': [5.9, 6.4, 7, 7.7, 8.4, 9.3, 10.2],
                        '67.5': [6, 6.5, 7.1, 7.8, 8.5, 9.4, 10.4],
                        '68': [6.1, 6.6, 7.2, 7.9, 8.7, 9.5, 10.5],
                        '68.5': [6.2, 6.7, 7.3, 8, 8.8, 9.7, 10.7],
                        '69': [6.3, 6.8, 7.4, 8.1, 8.9, 9.8, 10.8],
                        '69.5': [6.3, 6.9, 7.5, 8.2, 9, 9.9, 10.9],
                        '70': [6.4, 7, 7.6, 8.3, 9.1, 10, 11.1],
                        '70.5': [6.5, 7.1, 7.7, 8.4, 9.2, 10.1, 11.2],
                        '71': [6.6, 7.1, 7.8, 8.5, 9.3, 10.3, 11.3],
                        '71.5': [6.7, 7.2, 7.9, 8.6, 9.4, 10.4, 11.5],
                        '72': [6.7, 7.3, 8, 8.7, 9.5, 10.5, 11.6],
                        '72.5': [6.8, 7.4, 8.1, 8.8, 9.7, 10.6, 11.7],
                        '73': [6.9, 7.5, 8.1, 8.9, 9.8, 10.7, 11.8],
                        '73.5': [7, 7.6, 8.2, 9, 9.9, 10.8, 12],
                        '74': [7, 7.6, 8.3, 9.1, 10, 11, 12.1],
                        '74.5': [7.1, 7.7, 8.4, 9.2, 10.1, 11.1, 12.2],
                        '75': [7.2, 7.8, 8.5, 9.3, 10.2, 11.2, 12.3],
                        '75.5': [7.2, 7.9, 8.6, 9.4, 10.3, 11.3, 12.5],
                        '76': [7.3, 8, 8.7, 9.5, 10.4, 11.4, 12.6],
                        '76.5': [7.4, 8, 8.7, 9.6, 10.5, 11.5, 12.7],
                        '77': [7.5, 8.1, 8.8, 9.6, 10.6, 11.6, 12.8],
                        '77.5': [7.5, 8.2, 8.9, 9.7, 10.7, 11.7, 12.9],
                        '78': [7.6, 8.3, 9, 9.8, 10.8, 11.8, 13.1],
                        '78.5': [7.7, 8.4, 9.1, 9.9, 10.9, 12, 13.2],
                        '79': [7.8, 8.4, 9.2, 10, 11, 12.1, 13.3],
                        '79.5': [7.8, 8.5, 9.3, 10.1, 11.1, 12.2, 13.4],
                        '80': [7.9, 8.6, 9.4, 10.2, 11.2, 12.3, 13.6],
                        '80.5': [8, 8.7, 9.5, 10.3, 11.3, 12.4, 13.7],
                        '81': [8.1, 8.8, 9.6, 10.4, 11.4, 12.6, 13.9],
                        '81.5': [8.2, 8.9, 9.7, 10.6, 11.6, 12.7, 14],
                        '82': [8.3, 9, 9.8, 10.7, 11.7, 12.8, 14.1],
                        '82.5': [8.4, 9.1, 9.9, 10.8, 11.8, 13, 14.3],
                        '83': [8.5, 9.2, 10, 10.9, 11.9, 13.1, 14.5],
                        '83.5': [8.5, 9.3, 10.1, 11, 12.1, 13.3, 14.6],
                        '84': [8.6, 9.4, 10.2, 11.1, 12.2, 13.4, 14.8],
                        '84.5': [8.7, 9.5, 10.3, 11.3, 12.3, 13.5, 14.9],
                        '85': [8.8, 9.6, 10.4, 11.4, 12.5, 13.7, 15.1],
                        '85.5': [8.9, 9.7, 10.6, 11.5, 12.6, 13.8, 15.3],
                        '86': [9, 9.8, 10.7, 11.6, 12.7, 14, 15.4],
                        '86.5': [9.1, 9.9, 10.8, 11.8, 12.9, 14.2, 15.6],
                        '87': [9.2, 10, 10.9, 11.9, 13, 14.3, 15.8],
                        '87.5': [9.3, 10.1, 11, 12, 13.2, 14.5, 15.9],
                        '88': [9.4, 10.2, 11.1, 12.1, 13.3, 14.6, 16.1],
                        '88.5': [9.5, 10.3, 11.2, 12.3, 13.4, 14.8, 16.3],
                        '89': [9.6, 10.4, 11.4, 12.4, 13.6, 14.9, 16.4],
                        '89.5': [9.7, 10.5, 11.5, 12.5, 13.7, 15.1, 16.6],
                        '90': [9.8, 10.6, 11.6, 12.6, 13.8, 15.2, 16.8],
                        '90.5': [9.9, 10.7, 11.7, 12.8, 14, 15.4, 16.9],
                        '91': [10, 10.9, 11.8, 12.9, 14.1, 15.5, 17.1],
                        '91.5': [10.1, 11, 11.9, 13, 14.3, 15.7, 17.3],
                        '92': [10.2, 11.1, 12, 13.1, 14.4, 15.8, 17.4],
                        '92.5': [10.3, 11.2, 12.1, 13.3, 14.5, 16, 17.6],
                        '93': [10.4, 11.3, 12.3, 13.4, 14.7, 16.1, 17.8],
                        '93.5': [10.5, 11.4, 12.4, 13.5, 14.8, 16.3, 17.9],
                        '94': [10.6, 11.5, 12.5, 13.6, 14.9, 16.4, 18.1],
                        '94.5': [10.7, 11.6, 12.6, 13.8, 15.1, 16.6, 18.3],
                        '95': [10.8, 11.7, 12.7, 13.9, 15.2, 16.7, 18.5],
                        '95.5': [10.8, 11.8, 12.8, 14, 15.4, 16.9, 18.6],
                        '96': [10.9, 11.9, 12.9, 14.1, 15.5, 17, 18.8],
                        '96.5': [11, 12, 13.1, 14.3, 15.6, 17.2, 19],
                        '97': [11.1, 12.1, 13.2, 14.4, 15.8, 17.4, 19.2],
                        '97.5': [11.2, 12.2, 13.3, 14.5, 15.9, 17.5, 19.3],
                        '98': [11.3, 12.3, 13.4, 14.7, 16.1, 17.7, 19.5],
                        '98.5': [11.4, 12.4, 13.5, 14.8, 16.2, 17.9, 19.7],
                        '99': [11.5, 12.5, 13.7, 14.9, 16.4, 18, 19.9],
                        '99.5': [11.6, 12.7, 13.8, 15.1, 16.5, 18.2, 20.1],
                        '100': [11.7, 12.8, 13.9, 15.2, 16.7, 18.4, 20.3],
                        '100.5': [11.9, 12.9, 14.1, 15.4, 16.9, 18.6, 20.5],
                        '101': [12, 13, 14.2, 15.5, 17, 18.7, 20.7],
                        '101.5': [12.1, 13.1, 14.3, 15.7, 17.2, 18.9, 20.9],
                        '102': [12.2, 13.3, 14.5, 15.8, 17.4, 19.1, 21.1],
                        '102.5': [12.3, 13.4, 14.6, 16, 17.5, 19.3, 21.4],
                        '103': [12.4, 13.5, 14.7, 16.1, 17.7, 19.5, 21.6],
                        '103.5': [12.5, 13.6, 14.9, 16.3, 17.9, 19.7, 21.8],
                        '104': [12.6, 13.8, 15, 16.4, 18.1, 19.9, 22],
                        '104.5': [12.8, 13.9, 15.2, 16.6, 18.2, 20.1, 22.3],
                        '105': [12.9, 14, 15.3, 16.8, 18.4, 20.3, 22.5],
                        '105.5': [13, 14.2, 15.5, 16.9, 18.6, 20.5, 22.7],
                        '106': [13.1, 14.3, 15.6, 17.1, 18.8, 20.8, 23],
                        '106.5': [13.3, 14.5, 15.8, 17.3, 19, 21, 23.2],
                        '107': [13.4, 14.6, 15.9, 17.5, 19.2, 21.2, 23.5],
                        '107.5': [13.5, 14.7, 16.1, 17.7, 19.4, 21.4, 23.7],
                        '108': [13.7, 14.9, 16.3, 17.8, 19.6, 21.7, 24],
                        '108.5': [13.8, 15, 16.4, 18, 19.8, 21.9, 24.3],
                        '109': [13.9, 15.2, 16.6, 18.2, 20, 22.1, 24.5],
                        '109.5': [14.1, 15.4, 16.8, 18.4, 20.3, 22.4, 24.8],
                        '110': [14.2, 15.5, 17, 18.6, 20.5, 22.6, 25.1],
                        '110.5': [14.4, 15.7, 17.1, 18.8, 20.7, 22.9, 25.4],
                        '111': [14.5, 15.8, 17.3, 19, 20.9, 23.1, 25.7],
                        '111.5': [14.7, 16, 17.5, 19.2, 21.2, 23.4, 26],
                        '112': [14.8, 16.2, 17.7, 19.4, 21.4, 23.6, 26.2],
                        '112.5': [15, 16.3, 17.9, 19.6, 21.6, 23.9, 26.5],
                        '113': [15.1, 16.5, 18, 19.8, 21.8, 24.2, 26.8],
                        '113.5': [15.3, 16.7, 18.2, 20, 22.1, 24.4, 27.1],
                        '114': [15.4, 16.8, 18.4, 20.2, 22.3, 24.7, 27.4],
                        '114.5': [15.6, 17, 18.6, 20.5, 22.6, 25, 27.8],
                        '115': [15.7, 17.2, 18.8, 20.7, 22.8, 25.2, 28.1],
                        '115.5': [15.9, 17.3, 19, 20.9, 23, 25.5, 28.4],
                        '116': [16, 17.5, 19.2, 21.1, 23.3, 25.8, 28.7],
                        '116.5': [16.2, 17.7, 19.4, 21.3, 23.5, 26.1, 29],
                        '117': [16.3, 17.8, 19.6, 21.5, 23.8, 26.3, 29.3],
                        '117.5': [16.5, 18, 19.8, 21.7, 24, 26.6, 29.6],
                        '118': [16.6, 18.2, 19.9, 22, 24.2, 26.9, 29.9],
                        '118.5': [16.8, 18.4, 20.1, 22.2, 24.5, 27.2, 30.3],
                        '119': [16.9, 18.5, 20.3, 22.4, 24.7, 27.4, 30.6],
                        '119.5': [17.1, 18.7, 20.5, 22.6, 25, 27.7, 30.9],
                        '120': [17.3, 18.9, 20.7, 22.8, 25.2, 28, 31.2],
                    }
                ];

                conclusions = [
                    {
                        'conclusion': 'COMPLICATED SEVERE ACUTE MALNUTRITION',
                        'action': 'Give first dose appropriate antibiotic; Treat the child to prevent low blood sugar; Keep the child warm; Refer URGENTLY to hospital'
                    },
                    {
                        'conclusion': 'UNCOMPLICATED SEVERE ACUTE MALNUTRITION',
                        'action': 'Give oral antibiotics for 5 days; Give ready-to-use therapeutic food for a child aged 6 months or more; Counsel the mother on how to feed the child; Assess for possible TB infection; Advise mother when to return immediately; Follow up in 7 days'
                    },
                    {
                        'conclusion': 'MODERATE ACUTE MALNUTRITION',
                        'action': 'Assess the child\'s feeding and counsel the mother on the feeding recommendations; If feeding problem, follow up in 7 days; Assess for possible TB infection; Advise mother when to return immediately; Follow-up in 30 days'
                    },
                    {
                        'conclusion': 'NO ACUTE MALNUTRITION',
                        'action': 'If child is less than 2 years old, assess the child\'s feeding and counsel the mother on feeding according to the feeding recommendations; If feeding problem, follow-up in 7 days'
                    },
                ];
            };


        service.getInitialHeight = function (gender, age) {
            //set the height of the age with 50% number
            return Math.round(parseFloat(heightTabls[gender][age][7]));
        };

        service.getInitialWeight = function (gender, age, height) {
            var weights = determineWeights(gender, age, height);
            return parseFloat(weights[3]);
        };

        service.getZScore = function (gender, age, height, weight) {
            return determineZScore(gender, age, height, weight / 1000);
        };

        service.getReport = function (data) {
            var index = 0;

            if (data['oedema'] == 0) { // no oedema of both feet
                var index1 = 0; // judge from zscore
                var zscore = determineZScore(data['gender'], data['age'], data['height'], data['weight'] / 1000);
                if (zscore >= -3) {
                    if (zscore >= -2) {
                        index1 = 3;
                    } else {
                        index1 = 2;
                    }
                } else { // zscore < -3
                    // AND any one of the following: Medical complication present or Not able to finish RUTF or Breastfeeding problem.
                    if (data['rutf'] == 0 || data['mcp'] == 1 || data['bfp'] == 1) {
                        index1 = 0;

                    } else {
                        index1 = 1;
                    }
                }

                var index2 = 0; // judge from muac
                var muac = data['muac'];
                if (muac >= 115) {
                    if (muac >= 125) {
                        index2 = 3;
                    } else {
                        index2 = 2;
                    }
                } else { // muac < 115cm
                    // AND any one of the following: Medical complication present or Not able to finish RUTF or Breastfeeding problem.
                    if (data['rutf'] == 0 || data['mcp'] == 1 || data['bfp'] == 1) {
                        index2 = 0;

                    } else {
                        index2 = 1;
                    }
                }

                // choose the bigger result
                index = index1 > index2 ? index1 : index2;
            }

            return conclusions[index];
        };

        init();

        return service;

}])

.factory('MySteps', ['$q', '$log', '$state', 'MY_PARAMS', 'MyDiagnose',
    function ($q, $log, $state, MY_PARAMS, myDiagnose) {
        var initialized = false,
            template = {},
            startStep = 'introduction',
            previousSteps = [],
            currentStep = 'introduction',
            result = {},

            service = {},

            switchState = function (step, value) {
                $log.debug('MySteps.switchState' + ' step:' + step + ' value:' + value);

                var route = template[step].state(value);
                $state.go(route.to, route.params);
            };

        service.init = function () {
            // avoid double initialize
            if (initialized) {
                return;
            }

            initialized = true;

            template = {
                'introduction': {
                    'title': 'WHOAMI',
                    'shortText': 'Introduction',
                    'longText': 'The app will collect data and give diagnostic proposal according to the World Health Organization Acute Malnutrition guide.',
                    'next': function (value) {
                        return 'oedema';
                    },
                    'state': function (value) {
                        return {
                            to: 'app.briefing',
                            params: {
                                step: 'introduction'
                            },
                        };
                    },
                },
                'oedema': {
                    'title': 'STEP ONE',
                    'shortText': 'Oedema',
                    'longText': 'Oedema of both feet?',
                    'options': [
                        [
                            {
                                key: 1,
                                value: 'YES'
                            },
                            {
                                key: 0,
                                value: 'NO'
                            },
                        ],
                    ],
                    'summary': function (value) {
                        return (value == 1 ? 'Found oedema of both feet' : 'Not found oedema of both feet');
                    },
                    'next': function (value) {
                        return (value == 1 ? 'summary' : 'gender');
                    },
                    'state': function (value) {
                        return {
                            to: 'app.choice',
                            params: {
                                step: 'oedema'
                            },
                        };
                    },
                },
                'gender': {
                    'title': 'STEP TWO',
                    'shortText': 'Gender',
                    'longText': 'Boy or girl?',
                    'options': [
                        [
                            {
                                key: 'boy',
                                value: '<span class="icon-left ion-man big-font">Boy</span>'
                            },
                            {
                                key: 'girl',
                                value: '<span class="icon-left ion-woman">Girl</span>'
                            },
                        ],
                    ],
                    'summary': function (value) {
                        return (value == 'boy' ? 'Boy' : 'Girl');
                    },
                    'next': function (value) {
                        return 'age';
                    },
                    'state': function (value) {
                        return {
                            to: 'app.choice',
                            params: {
                                step: 'gender'
                            },
                        };
                    },
                },
                'age': {
                    'title': 'STEP THREE',
                    'shortText': 'Age',
                    'longText': 'How old is the child?',
                    'options': {
                        'myValue': function () {
                            if (result['age']) {
                                return result['age'];
                            }

                            return 24;
                        },
                        'myMin': 0,
                        'myMax': 60,
                        'myScale': function (v) {
                            return v;
                        },
                        'myFormat': function (v) {
                            var y = parseInt(v / 12);
                            var m = v - y * 12;
                            return (v > 0 ? (y > 0 ? y + 'yr' : '') + (m > 0 ? m + 'm' : '') : '0m');
                        },
                    },
                    'summary': function (value) {
                        var y = parseInt(value / 12);
                        var m = value - y * 12;
                        return (value > 0 ? (y > 0 ? y + ' year ' : '') + (m > 0 ? m + ' month' : '') : '0 month') + ' old';
                    },
                    'next': function (value) {
                        return 'height';
                    },
                    'state': function (value) {
                        return {
                            to: 'app.knob',
                            params: {
                                step: 'age'
                            },
                        };
                    },
                },
                'height': {
                    'title': 'STEP FOUR',
                    'shortText': 'Height',
                    'longText': 'The child\'s height is',
                    'options': {
                        'myValue': function () {
                            if (result['height']) {
                                return result['height'];
                            }

                            return myDiagnose.getInitialHeight(result['gender'], result['age']);
                        },
                        'myMin': 45,
                        'myMax': 120,
                        'myScale': function (v) {
                            return v * 0.5;
                        },
                        'myFormat': function (v) {
                            return (Math.floor(v) < v ? v : v + '.0') + 'cm';
                        },
                    },
                    'summary': function (value) {
                        return value + 'cm tall';
                    },
                    'next': function (value) {
                        return 'weight';
                    },
                    'state': function (value) {
                        return {
                            to: 'app.knob',
                            params: {
                                step: 'height'
                            },
                        };
                    },
                },
                'weight': {
                    'title': 'STEP FIVE',
                    'shortText': 'Weight',
                    'longText': 'The child\'s weight is',
                    'options': {
                        'myValue': function () {
                            var weight = myDiagnose.getInitialWeight(result['gender'], result['age'], result['height']);
                            return weight * 1000;
                        },
                        'myMin': 1900,
                        'myMax': 30100,
                        'myScale': function (v) {
                            return v * 100;
                        },
                        'myFormat': function (v) {
                            v = v / 1000;
                            return (Math.floor(v) < v ? v : v + '.0') + 'kg';
                        },
                    },
                    'summary': function (value) {
                        return value / 1000 + 'kg weight';
                    },
                    'next': function (value) {
                        var zscore = myDiagnose.getZScore(result['gender'], result['age'], result['height'], result['weight']);
                        return (zscore < -3 ? 'rutf' : 'muac');
                    },
                    'state': function (value) {
                        return {
                            to: 'app.knob',
                            params: {
                                step: 'weight'
                            },
                        };
                    },
                },
                'muac': {
                    'title': 'STEP SIX',
                    'shortText': 'MUAC',
                    'longText': 'The child\'s mid-upper arm circumference (MUAC) is',
                    'options': {
                        'myValue': 115,
                        'myMin': 0,
                        'myScale': function (v) {
                            return v;
                        },
                        'myFormat': function (v) {
                            return v + 'cm';
                        },
                    },
                    'summary': function (value) {
                        return value + 'cm MUAC';
                    },
                    'next': function (value) {
                        return (value > 115 ? 'summary' : 'rutf');
                    },
                    'state': function (value) {
                        return {
                            to: 'app.knob',
                            params: {
                                step: 'muac'
                            },
                        };
                    },
                },
                'rutf': {
                    'title': 'STEP SEVEN',
                    'shortText': 'Ready-to-Use Therapeutic Food',
                    'longText': 'Is the child able to finish Ready-to-Use Therapeutic Food?',
                    'options': [
                        [
                            {
                                key: 1,
                                value: 'YES'
                            },
                            {
                                key: 0,
                                value: 'NO'
                            },
                        ],
                    ],
                    'summary': function (value) {
                        return (value == 0 ? 'Not able to finish RUTF' : 'Able to finish RUTF');
                    },
                    'next': function (value) {
                        return (value == 0 ? 'summary' : 'mcp');
                    },
                    'state': function (value) {
                        return {
                            to: 'app.choice',
                            params: {
                                step: 'rutf'
                            },
                        };
                    },
                },
                'mcp': {
                    'title': 'STEP EIGHT',
                    'shortText': 'Medical Complication Present',
                    'longText': 'Does the child have medical complication present?',
                    'options': [
                        [
                            {
                                key: 1,
                                value: 'YES'
                            },
                            {
                                key: 0,
                                value: 'NO'
                            },
                        ],
                    ],
                    'summary': function (value) {
                        return (value == 0 ? 'No medical complication present' : 'Medical complication present');
                    },
                    'next': function (value) {
                        return (value == 1 ? 'summary' : 'bfp');
                    },
                    'state': function (value) {
                        return {
                            to: 'app.choice',
                            params: {
                                step: 'mcp'
                            },
                        };
                    },
                },
                'bfp': {
                    'title': 'STEP HINE',
                    'shortText': 'Breastfeeding Problem',
                    'longText': 'Does the child have breastfeeding problem?',
                    'options': [
                        [
                            {
                                key: 1,
                                value: 'YES'
                            },
                            {
                                key: 0,
                                value: 'NO'
                            },
                        ],
                    ],
                    'summary': function (value) {
                        return (value == 0 ? 'No breastfeeding problem' : 'Breastfeeding problem');
                    },
                    'next': function (value) {
                        return 'summary';
                    },
                    'state': function (value) {
                        return {
                            to: 'app.choice',
                            params: {
                                step: 'bfp'
                            },
                        };
                    },
                },
                'summary': {
                    'title': 'Summary',
                    'shortText': 'Collected Information',
                    'next': function (value) {
                        return 'diagnose';
                    },
                    'state': function (value) {
                        return {
                            to: 'app.summary',
                        };
                    },
                },
                'diagnose': {
                    'title': 'Diagnose',
                    'shortText': 'Nutritional Status',
                    'state': function (value) {
                        return {
                            to: 'app.diagnose',
                        };
                    },
                },
            }
        };


        service.hasPreviousStep = function () {
            return (previousSteps.length > 0);
        };

        service.getCurrentStepTemplate = function () {
            return service.getStepTempate(currentStep);
        };

        service.getStepTempate = function (step) {
            return template[step];
        };

        // Restart all steps
        service.restart = function (skipIntro) {
            previousSteps = [];
            currentStep = startStep;
            result = {};
            if (skipIntro) {
                service.next();
            } else {
                switchState(currentStep, null);
            }
        };

        // Switch to previous step state
        service.prev = function () {
            if (previousSteps.length > 0) {
                currentStep = previousSteps.pop();
                var value = (previousSteps.length > 0 ? result[previousSteps[previousSteps.length - 1]] : null);
                switchState(currentStep, value);
            }
        };

        // keep value and switch to next step state
        service.next = function (value) {

            if (value != null) {
                result[currentStep] = value;
            }

            previousSteps.push(currentStep);
            currentStep = template[currentStep].next(value);

            switchState(currentStep, value);
        };

        service.getResult = function () {
            return result;
        };

        service.getReport = function () {
            return myDiagnose.getReport(result);
        }

        service.getStepSummary = function (step) {
            var func = function (value, key) {
                return key + ' = ' + value;
            };

            if (template[step] && template[step]['summary'] && angular.isFunction(template[step]['summary'])) {
                func = template[step]['summary'];
            }

            return func;
        };

        return service;
    }]);
